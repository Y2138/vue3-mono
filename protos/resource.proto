syntax = "proto3";
package resource;

import "common.proto";

// 基础资源类型（不包含children，用于列表和详情）
message Resource {
  string id = 1;
  string name = 2;
  int32 type = 3;  // 使用基础类型代替枚举
  string resCode = 4;  // 资源码 - 基于RBAC权限系统的统一资源标识
  optional string icon = 5;  // 可选字段使用optional
  optional string parentId = 6;  // 可选字段
  int32 sortOrder = 7;
  bool isActive = 8;
  string createdAt = 9;
  string updatedAt = 10;
  optional string description = 11;  // 可选字段
  int32 level = 12;
  // 移除metadata字段，code不再在metadata中维护，改为独立字段resCode
  string path = 13;
}

// 树形资源类型（包含children，用于树形结构）
message ResourceTree {
  string id = 1;
  string name = 2;
  int32 type = 3;  // 使用基础类型
  string resCode = 4;  // 资源码 - 基于RBAC权限系统的统一资源标识
  optional string icon = 5;  // 可选字段
  optional string parentId = 6;  // 可选字段
  int32 sortOrder = 7;
  bool isActive = 8;
  string createdAt = 9;
  string updatedAt = 10;
  optional string description = 11;  // 可选字段
  int32 level = 12;
  // 移除metadata字段，code不再在metadata中维护，改为独立字段resCode
  string path = 13;
  repeated ResourceTree children = 14;  // 树形结构包含children
}

message CreateResourceRequest {
  string name = 1;
  int32 type = 2;  // 使用基础类型（1=page, 2=api, 3=module）
  optional string parentId = 3;  // 可选字段
  string path = 4;
  optional string description = 5;  // 可选字段
  // 移除metadata字段，resCode将在服务端自动生成
}

message UpdateResourceRequest {
  string id = 1;
  string name = 2;
  int32 type = 3;  // 使用基础类型（1=page, 2=api, 3=module）
  optional string parentId = 4;  // 可选字段
  string path = 5;
  optional string description = 6;  // 可选字段
  bool isActive = 7;
  // 移除metadata字段，resCode将在服务端自动生成或更新
}

message GetResourceRequest {
  string id = 1;
}

message GetResourcesRequest {
  optional int32 type = 1;  // 资源类型
  optional string name = 2; // 资源名称
  optional string path = 3; // 资源路径
  optional int32 isActive = 4; // 资源状态

  common.PaginationRequest pagination = 5; // 分页信息
}

message GetResourceByPathRequest {
  string path = 1;
}

message MoveResourceRequest {
  string id = 1;
  optional string parentId = 2;
}

message DuplicateResourceRequest {
  string id = 1;
  optional string parentId = 2;
  optional string newName = 3;
}

message BatchDeleteResourcesRequest {
  repeated string ids = 1;
}

message ResourceListResponse {
  repeated Resource data = 1;
}

message ResourceResponse {
  Resource data = 1;
}

message ResourceTreeResponse {
  repeated ResourceTree data = 1;  // 树形响应使用ResourceTree类型
}

message ResourcePathResponse {
  repeated Resource data = 1;  // 路径响应使用基础Resource类型
}

service ResourceService {
  // 获取资源枚举
  rpc GetResourceEnums(common.EmptyRequest) returns (common.EnumResponse);

  // 创建资源
  rpc CreateResource(CreateResourceRequest) returns (ResourceResponse);

  // 获取资源列表
  rpc GetResources(GetResourcesRequest) returns (ResourceListResponse);

  // 获取资源树
  rpc GetResourceTree(GetResourcesRequest) returns (ResourceTreeResponse);

  // 根据ID获取资源
  rpc GetResource(GetResourceRequest) returns (ResourceResponse);

  // 获取资源路径
  rpc GetResourcePath(GetResourceRequest) returns (ResourcePathResponse);

  // 获取资源子级树
  rpc GetSubtree(GetResourceRequest) returns (ResourceTreeResponse);

  // 更新资源
  rpc UpdateResource(UpdateResourceRequest) returns (ResourceResponse);

  // 移动资源
  rpc MoveResource(MoveResourceRequest) returns (ResourceResponse);

  // 复制资源
  rpc DuplicateResource(DuplicateResourceRequest) returns (ResourceResponse);

  // 删除资源
  rpc DeleteResource(GetResourceRequest) returns (common.ResponseStatus);

  // 批量删除资源
  rpc BatchDeleteResources(BatchDeleteResourcesRequest) returns (common.ResponseStatus);

  // 根据路径获取资源
  rpc GetResourceByPath(GetResourceByPathRequest) returns (ResourceResponse);

  // 验证树形结构
  rpc ValidateTree(common.EmptyRequest) returns (common.ResponseStatus);
}
