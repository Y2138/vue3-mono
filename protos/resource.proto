syntax = "proto3";
package resource;

import "common.proto";

// 资源类型说明（使用int32基础类型，不使用enum）
// 1 = MENU - 菜单资源：用于前端菜单显示，通常是顶层和二级目录资源
// 2 = PAGE - 页面资源：用于前端路由页面，通常是具体的业务页面
// 3 = API - 接口资源：用于后端API接口权限控制
// 4 = MODULE - 模块资源：用于功能模块级别的权限控制

// 基础资源类型（不包含children，用于列表和详情）
message Resource {
  string id = 1;
  string name = 2;
  int32 type = 3;  // 使用基础类型代替枚举
  string resCode = 4;  // 资源码 - 基于RBAC权限系统的统一资源标识
  optional string icon = 5;  // 可选字段使用optional
  optional string parentId = 6;  // 可选字段
  int32 sortOrder = 7;
  bool isActive = 8;
  string createdAt = 9;
  string updatedAt = 10;
  optional string description = 11;  // 可选字段
  int32 level = 12;
  // 移除metadata字段，code不再在metadata中维护，改为独立字段resCode
  string path = 13;
  optional string suffix = 14;  // 资源后缀，模块类型专用
  string typeDesc = 15;  // 资源类型描述
}

// 树形资源类型（包含children，用于树形结构）
message ResourceTree {
  string id = 1;
  string name = 2;
  int32 type = 3;  // 使用基础类型
  string resCode = 4;  // 资源码 - 基于RBAC权限系统的统一资源标识
  optional string icon = 5;  // 可选字段
  optional string parentId = 6;  // 可选字段
  int32 sortOrder = 7;
  bool isActive = 8;
  string createdAt = 9;
  string updatedAt = 10;
  optional string description = 11;  // 可选字段
  int32 level = 12;
  // 移除metadata字段，code不再在metadata中维护，改为独立字段resCode
  string path = 13;
  optional string suffix = 14;  // 资源后缀，模块类型专用
  repeated ResourceTree children = 15;  // 树形结构包含children
}

message CreateResourceRequest {
  string name = 1;
  int32 type = 2;  // 使用基础类型（1=menu, 2=page, 3=api, 4=module）
  optional string parentId = 3;  // 可选字段
  string path = 4;
  int32 sortOrder = 5;  // 排序字段
  optional string description = 6;  // 可选字段
  optional string suffix = 7;  // 资源后缀，模块类型专用
  // 移除metadata字段，resCode将在服务端自动生成
}

message UpdateResourceRequest {
  string id = 1;
  string name = 2;
  int32 type = 3;  // 使用基础类型（1=menu, 2=page, 3=api, 4=module）
  optional string parentId = 4;  // 可选字段
  string path = 5;
  int32 sortOrder = 6;  // 排序字段
  optional string description = 7;  // 可选字段
  bool isActive = 8;
  // 注意：更新时不能修改suffix字段，resCode将在服务端自动生成或更新
}

message GetResourceRequest {
  string id = 1;
}

message GetResourcesRequest {
  optional int32 type = 1;  // 资源类型
  optional string name = 2; // 资源名称
  optional string path = 3; // 资源路径
  optional int32 isActive = 4; // 资源状态

  common.PaginationRequest pagination = 5; // 分页信息
}

message ResourceListResponse {
  repeated Resource data = 1;
}

message ResourceResponse {
  Resource data = 1;
}

message ResourceTreeResponse {
  repeated ResourceTree data = 1;  // 树形响应使用ResourceTree类型
}

service ResourceService {
  // 获取资源枚举
  rpc GetResourceEnums(common.EmptyRequest) returns (common.EnumResponse);

  // 创建资源
  rpc CreateResource(CreateResourceRequest) returns (ResourceResponse);

  // 获取资源列表
  rpc GetResources(GetResourcesRequest) returns (ResourceListResponse);

  // 获取资源树
  rpc GetResourceTree(GetResourcesRequest) returns (ResourceTreeResponse);

  // 根据ID获取资源
  rpc GetResource(GetResourceRequest) returns (ResourceResponse);

  // 更新资源
  rpc UpdateResource(UpdateResourceRequest) returns (ResourceResponse);

  // 删除资源
  rpc DeleteResource(GetResourceRequest) returns (common.ResponseStatus);
}
