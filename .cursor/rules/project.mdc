---
alwaysApply: true
---

# 项目概览

全栈 TypeScript monorepo，前后端分离架构。

## 技术栈

**前端**: Vue 3.5.18+ (Composition API) + Vite 6.1+ + Naive UI 2.41+ + UnoCSS 0.65+ + Pinia 2.3+ + Axios 1.7+ + Vue Router 4.5+

**后端**: NestJS 11+ + GraphQL/Apollo Server 3.13+ + PostgreSQL + Prisma 6.13+ + JWT/Passport + Redis

**工具链**: pnpm workspace + Turbo 2.2+ + Oxlint 1.8+ + TypeScript 5.9.2 + Vitest/Jest + Node 22.17.1 LTS

## 项目结构

```
apps/naive-admin/src/     # 前端：components, hooks, request, router, shared, store, views
server/nest-main/src/     # 后端：modules, config, common, prisma, shared
packages/                  # 共享包
protos/                    # Proto 定义
```

## 开发流程

### 标准流程（类型驱动）

1. 定义 Proto 类型 → `pnpm run generate:types` 生成共享类型
2. 定义 Prisma Schema → 添加模型和索引
3. 实现后端：Service（业务逻辑）→ Controller（接口组装，继承 BaseController）→ 模块配置
4. 实现前端：API 函数 → composable 封装
5. 测试接口

### 后端 6 步流程

1. 需求设计与架构规划
2. 定义 Prisma 数据模型（关联关系、索引）
3. 定义 Proto 类型 → 生成 `src/shared/*.ts`
4. 创建 Service 层（业务逻辑、异常处理、Prisma 查询优化）
5. 创建 Controller 层（继承 BaseController，query 参数优先，完整 API 装饰器）
6. 配置模块（依赖关系、初始化逻辑）

### 前端开发要点

- **组件分类**: 公共组件 → `packages/components/ui`；业务组件 → `src/components`；业务内组件 → 同目录 `components`
- **类型使用**: Proto 生成类型 → API 扩展类型 → 本地类型。禁止 `any`，优先 `unknown`。使用工具类型转换
- **API 请求**: `get<Q, R>()` / `post<Q, R>()`，返回 `Promise<[ResResult<R>, null] | [null, any]>`，拦截器处理错误
- **状态管理**: `ref`/`reactive` + 自定义 Hook（`useTablePage`、`useEnums`、`usePageLoading`）
- **UI/表单**: Naive UI + `@iconify/vue` + UnoCSS + `dForm` 组件系统

## 核心组件

**前端**: dForm（表单）、SearchPanel（搜索）、WrapRow/WrapCol（布局）、请求系统（axios 封装）

**后端**: BaseController（控制器基类）、PrismaService（数据库服务）、filters/guards/interceptors（全局组件）

## 开发规范

**通用**: 禁止捏造内容、oxlint/prettier 规则、2 空格缩进、测试放 `test/`、使用 context7 mcp、TODO 注释、每步需确认

**命名**: 目录 kebab-case、变量 camelCase、常量 UPPER_SNAKE_CASE、组件 PascalCase、函数纯函数用 `function`

**TypeScript**: 优先 `interface`、避免 `enum`、泛型语义化（T/K/V/E）、严格模式

**代码风格**: import 顺序（Vue → 第三方 → 项目 → 组件 → 类型）、函数参数 ≤3、统一 `ref` + `script setup`、优先 Vueuse

**API/组件**: 使用 `get<Q, R>()`/`post<Q, R>()`、拦截器错误处理、dForm/useTablePage/WrapRow/SearchPanel

**类型**: 禁止 `any`、`src/shared` 引用、工具类型推导、通用类型才单独 `type.ts`

**数据**: 日期格式 `YYYY-MM-DD`

## 环境配置

**开发**: Node 22.17.1 LTS、pnpm workspace、前端 :6767、后端 :3030、PostgreSQL、Redis

**构建**: Vite/NestJS build、PWA、`/api` 代理

**质量**: OxLint、TS 严格模式、Vitest/Jest、Git hooks

## 最佳实践

**前端**: Composition API、Pinia、props/emits、Vue Router 4+、UnoCSS、按需导入/懒加载

**后端**: Proto 类型定义、模块化单一职责、装饰器、统一错误处理、Prisma、索引/分页

**性能**: 按需导入、懒加载、接口缓存、图片优化、Bundle 分包

## 扩展指南

**新页面**: `src/views/` 创建 → `src/router/modules/` 配置路由 → 权限标识

**新组件**: 按分类选择位置 → 类型定义 → 导出（如适用）

**新 API**: `protos/` 定义 → `pnpm run generate:types` → `src/request/api/` 定义 → composable 封装

**后端模块**: 创建目录 → 6 步流程（Prisma Schema → Proto → Service → Controller → 模块）→ `app.module.ts` 注册
